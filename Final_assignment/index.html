<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Final Project - Social data analysis and visualization</title>
    <script type="text/javascript" src="d3/d3.js"></script>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <header class="bg-primary text-white">
        <div class="header-div"><img src="san-francisco2.jpg" alt="" class="header-img"></div>
    </header>
    <br>
    <section id="main">
      <div class="container">
        <h2>Homelessness in San Francisco</h2>
        <p class="lead">311 complaints for homeless concerns have grown over 550% in the last 8 years in San Francisco. Here we will give an idea on why that is.</p>
        <a href="explainer.html">Click here to go to explainer page.</a>
        <br><br>
        <p>First thought is that homelessness has grown exponentially over the population but as you can see on the graph below that is not the case.</p>

        <div id="lineGraph"></div>

        <p>Maybe there was some change to the 311 system that made people more open to complain? We went through the <a href="https://sf311.org/history">history of 311 calls in San Francisco</a> to check that possibility.</p>
        <ul>
          <li>March 30, 2007 - Start of 311 in San Francisco</li>
          <li>December 11, 2008 - New 311 Online Services</li>
          <li>August 8, 2013 - New 311 mobile app</li>
        </ul>

        <p>If we compare these dates with the graph below of all the homeless complaints each year we might be able to see some impacts.</p>

        <div id="barChart"></div>

        <p>For example the mobile app could have made it easier for people complain but in the app you are only allowed to submit request for: Abandoned Vehicles, Graffiti, Illegal Postings, Street or Sidewalk Cleaning, Streetlight Repair, Blocked Sidewalk or Space, Damaged Public Property, Litter Receptacle, Park Issue, Sign Repair, Street and Sidewalk Defect, and Tree Maintenance.</p>


        <div id="dayChart"></div>

        <button onclick="animateBrush()">Animate</button>

        <div id="geoGraph"></div>


        <div class="row">
          <div class="col-lg-8 mx-auto">
          </div>
        </div>
      </div>
    </section>

    <script>
      var callData;
      var circles;
      var barData = [];
      var dayData = [];
      var circleData = [];
      var yearData = [];
      yearData[2013] = [];
      yearData[2014] = [];
      yearData[2015] = [];
      var income = [];
      var parseTime = d3.timeParse("%m/%d/%Y %H:%M:%S %p");
      var brush;
      var gBrush;
      var geo;
      var earlierYear = 2013;
      var laterYear = 2015;

      d3.csv("clean_311_data.csv", function(rawData) {
        callData = rawData;
        processData(callData);

        barChart();
        geoGraph();
        dayChart();
      });

      function processData(data) {
        var processedData = [];
        var processedDayData = [];

        for (var i in data) {
          var time = parseTime(data[i]["Opened"]);
          if (time == null) {
            continue;
          }

          var year = parseInt(time.getFullYear());
          if (time == null || year == 2008 || year == 2018) {
            continue;
          }
          //For barchart
          if (!(year in processedData)) {
            processedData[year] = 0;
          }
          processedData[year]++;

          if (year == 2009 || year == 2010 || year == 2011 || year == 2012 || year == 2016 || year == 2017) {
            continue;
          }

          yearData[year].push(data[i]);

          if (year == 2013)
            circleData.push(data[i]);

          // For day Chart
          var dayString = (parseInt(time.getMonth())+1) + "/" + time.getDate() +"/"+ year;
          if (!(dayString in processedDayData)) {
            processedDayData[dayString] = 0;
          }
          processedDayData[dayString]++;

        }

        for (var data in processedData) {
          barData.push(
            {
              "year": data,
              "sum": processedData[data]
            }
          )
        }

        for (var data in processedDayData) {
          dayData.push(
            {
              "date": data,
              "sum": processedDayData[data]
            }
          )
        }
      }

      console.log(yearData)
    </script>

    <script src="scripts/line-graph.js"></script>
    <script src="scripts/bar-chart.js"></script>
    <script src="scripts/day-chart.js"></script>
    <script src="scripts/geo-graph.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
