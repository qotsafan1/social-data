<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Final Project - Social data analysis and visualization</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <header class="bg-primary text-white">
        <div class="header-div"><img src="san-francisco2.jpg" alt="" class="header-img"></div>
    </header>
    <br>
    <section id="main">
      <div class="container">
        <h2>Homelessness in San Francisco</h2>
        <p class="lead">311 complaints for homeless concerns have grown over 550% in the last 8 years in San Francisco. Why is that?</p>
        <a href="explainer.html">Click here to go to explainer page.</a>
        <br><br>
        <h4>But first, what is a 311 complaint? </h4>
        <p>According to <a href="https://en.wikipedia.org/wiki/3-1-1">Wikipedia</a>:</p>
        <blockquote cite="https://en.wikipedia.org/wiki/3-1-1">
        3-1-1 is a special telephone number supported in many communities in Canada and the United States. The number provides access to non-emergency municipal services. The number format follows the N11 code for a group of short, special-purpose local numbers as designated in the North American Numbering Plan.
        3-1-1 creates a central hub for constituents to be able to access a variety of city services. The number 3-1-1 is intended in part to divert routine inquiries and non-urgent community concerns from the 9-1-1 number which is reserved for emergency service. A promotional website for 3-1-1 in Akron described the distinction as follows: "Burning building? Call 9-1-1. Burning Question? Call 3-1-1."
        Many cities also accept 3-1-1 comments through online interfaces. An Open 311 application programming interface is also available for these services.
        </blockquote>
        <p>311 service request are grouped into categories, these are for example complaints about noise, reporting of graffiti or sighting of rats or other rodents. One of these categories are homeless concerns, that is people report that they are in some way concerned about the homeless or what they are doing. Over the last 8 years these types of 311 reports have grown 550% in San Francisco. What is the reason for that? We plan to find out!</p>
        <h4>San Francisco's population</h4>
        <p>Of course it is possible that the number of homeless people in San Francisco has grown so much in the past 8 years that the rise in 311 calls for homeless concerns is warranted. To test that theory we gathered data about the growth of homeless population and the population in general in San Francisco. The data was graphed and as can be seen below the growth in homeless population is much less that 550%, it is around 12 % for the last 12 years.</p>

        <div id="lineGraph"></div>
        <h4>Changes to the 311 system</h4>
        <p>Perhaps there was some changes to the 311 system that made it easier for people to make 311 reports? We went through the <a href="https://sf311.org/history">history of 311 calls in San Francisco</a> to check that possibility.
         Here below we can see dates of interest and what happened to the 311 system:</p>
        <ul>
          <li>March 30, 2007 - Start of 311 in San Francisco</li>
          <li>December 11, 2008 - New 311 Online Services</li>
          <li>August 8, 2013 - New 311 mobile app</li>
          <li>October 8, 2015 - New feature for the app, homeless concerns priority</li>
        </ul>

        <p>If we compare these dates with the graph below of all the homeless complaints each year we might be able to see some impacts.</p>

        <div id="barChart"></div>

        <p>For example the mobile app could have made it easier for people to report 311 cases but in the app you are originally only allowed to submit reports of/requests for: Abandoned Vehicles, Graffiti, Illegal Postings, Street or Sidewalk Cleaning, Streetlight Repair, Blocked Sidewalk or Space, Damaged Public Property, Litter Receptacle, Park Issue, Sign Repair, Street and Sidewalk Defect, and Tree Maintenance.
        Therefore the arrival of the new mobile app doesn't explain the rise in homeless concerns. However later, in 2015 they add the possibility of reporting homeless people and actually make it a priority. After some research online it seems that the homeless problem in San Francisco is a big problem at that time and the city is getting ready to host a lot of guests as in February 2016 the superbowl will be played in close by Levi's stadium. San Francisco seems embarrassed of the problem and want to clean as much of it up before the superbowl. These changes can be seen in the chart below where we have graphed the daily homeless reports from 2013 until 2016. Late 2015 there can be seen a big spike which is around the same time the feature is added to the app and city officials urge people to report homeless concerns.</p>

        <h4>Movement of the homeless</h4>
        <p>There is a possibility that the homeless have moved from one district, where is might be common to see homeless people, to another district, where it might not be common to see homeless people. Perhaps the homeless population is moving from low-class to high-class neighbourhoods and thus people are more prone to report them to 311. To see if that is the case we created a geographical representation of the city and divided it into its districts. We also colorcoded the districts to represent the average income of its inhabitants.</p>

        <div id="dayChart"></div>

        <button class="btn btn-info" onclick="animateBrush()">Animate</button>

        <div class="row">
          <div class="col-md-7" id="geoGraph"></div>
          <div class="col-md-4 color-board">
            <div class="row">
              <h4>Color code for average income in district</h4>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#ffe6e6"></div>
              <div class="col-xs-8">< $20.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#ffb3b3"></div>
              <div class="col-xs-8">$20.000 ~ $30.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#ff8080"></div>
              <div class="col-xs-8">$30.000 ~ $40.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#ff4d4d"></div>
              <div class="col-xs-8">$40.000 ~ $50.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#ff1a1a"></div>
              <div class="col-xs-8">$50.000 ~ $60.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#e60000"></div>
              <div class="col-xs-8">$60.000 ~ $70.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#cc0000"></div>
              <div class="col-xs-8">$70.000 ~ $80.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#b30000"></div>
              <div class="col-xs-8">$80.000 ~ $90.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#990000"></div>
              <div class="col-xs-8">$90.000 ~ $100.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#800000"></div>
              <div class="col-xs-8">$100.000 ~ $110.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#660000"></div>
              <div class="col-xs-8">$110.000 ~ $120.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#4d0000"></div>
              <div class="col-xs-8">$120.000 ~ $130.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#330000"></div>
              <div class="col-xs-8">$130.000 ~ $140.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#1a0000"></div>
              <div class="col-xs-8">$140.000 ~ $150.000</div>
            </div>
            <div class="row">
              <div class="col-xs-5 color-scale" style="background-color:#000000"></div>
              <div class="col-xs-8">> $150.000</div>
            </div>
          </div>
        </div>

        <div id="stackedArea"></div>

      <p>As can be seen from the animation and intercating with the graphs above the homeless concerns reported are mainly in districts where the income is lower. We can also see that most of the reports are in the Tenderloin district in downtown San Francisco. Crime rate is high as well in the Tenderloin district and the average income is quite low.</p>

      <h4>Conclusion</h4>
      <p>Homelessness is obviously a big problem in San Francisco and it seems to be getting worse. The homeless concerns reported in 311 reports are warranted but the huge rise in these reports can be attributed to it being easier and easier for people to make these reports with the internet and smartphone applications. It also seems as the awareness has been increased and people are more prone to report the homeless than before. However reporting the homeless doesn't seem to be helping in solving the problem and it is clear that different measures must be taken to tackle this problem. A part of San Francisco's population is getting rich and exploiting the high tech job market in Silicon Valley, meanwhile a big part of the population is getting poorer and their lives getting worse, the pay gap seems to be getting bigger and bigger while housing as well is getting more expensive. It is therefore not that surprising that San Francisco has this problem.</p>
      </div>

    </section>

    <script>
      var callData;
      var circles;
      var barData = [];
      var dayData = [];
      var circleData = [];
      var yearData = [];
      yearData[2013] = [];
      yearData[2014] = [];
      yearData[2015] = [];
      var income = [];
      var districtData = [];
      var parseTime = d3.timeParse("%m/%d/%Y %H:%M:%S %p");
      var brush;
      var gBrush;
      var geo;
      var geoJson;
      var earlierYear = 2013;
      var laterYear = 2015;
      var chosenDistrict;

      d3.csv("clean_311_data.csv", function(rawData) {
        callData = rawData;
        processData(callData);

        lineGraph();
        barChart();
        geoGraph();
        dayChart();
      });

      function processData(data) {
        var processedData = [];
        var processedDayData = [];
        var processedDistrictData = [];

        for (var i in data) {
          var time = parseTime(data[i]["Opened"]);
          if (time == null) {
            continue;
          }

          var year = parseInt(time.getFullYear());
          if (time == null || year == 2008 || year == 2018) {
            continue;
          }
          //For barchart
          if (!(year in processedData)) {
            processedData[year] = 0;
          }
          processedData[year]++;


          if (year == 2009 || year == 2010 || year == 2011 || year == 2012 || year == 2016 || year == 2017) {
            continue;
          }

          yearData[year].push(data[i]);

          if (!(data[i]["District"] in processedDistrictData)) {
            processedDistrictData[data[i]["District"]] = [];
            processedDistrictData[data[i]["District"]][2013] = [];
            processedDistrictData[data[i]["District"]][2014] = [];
            processedDistrictData[data[i]["District"]][2015] = [];


            for (var month = 0; month<12; month++) {
              processedDistrictData[data[i]["District"]][2013][month] = 0;
              processedDistrictData[data[i]["District"]][2014][month] = 0;
              processedDistrictData[data[i]["District"]][2015][month] = 0;
            }
          }
          processedDistrictData[data[i]["District"]][year][time.getMonth()]++;

          if (year == 2013)
            circleData.push(data[i]);

          // For day Chart
          var dayString = (parseInt(time.getMonth())+1) + "/" + time.getDate() +"/"+ year;
          if (!(dayString in processedDayData)) {
            processedDayData[dayString] = 0;
          }
          processedDayData[dayString]++;
        }

        for (var data in processedData) {
          barData.push(
            {
              "year": data,
              "sum": processedData[data]
            }
          )
        }

        for (var data in processedDayData) {
          dayData.push(
            {
              "date": data,
              "sum": processedDayData[data]
            }
          )
        }

        for (var district in processedDistrictData) {
          districtData[district] = [];
          for(var month = 0; month < 12; month++) {
            districtData[district].push({
              '2013': processedDistrictData[district.toString()][2013][month],
              '2014': processedDistrictData[district.toString()][2014][month],
              '2015': processedDistrictData[district.toString()][2015][month],
              'date': new Date(0001, month, 1)
            })
          }
        }

        updateStackedArea(districtData["06075010100"]);
      }
    </script>

    <script src="scripts/line-graph.js"></script>
    <script src="scripts/bar-chart.js"></script>
    <script src="scripts/day-chart.js"></script>
    <script src="scripts/geo-graph.js"></script>
    <script src="scripts/stacked_area.js"></script>
  </body>
</html>
